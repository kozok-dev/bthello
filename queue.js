const Queue=new function(){const t=[];var e=0,a=!1,l=null;function s(n){var c,i,o,u,r;if(!n&&t.length>0&&t.shift(),0!=t.length)switch(t[0].type){case"message":u=t[0].msg,r=0,e=0,Sound.play("message"),Tick.interval("message",function(t){r+=Math.round(t),e++;for(var a=u.substring(0,r),l=0,n=[];;){var c=a.indexOf("<",l);if(-1==c)break;if(l=c+1,-1==(c=u.indexOf(">",l)))break;var i=u.substring(l,c).match(/^(\/?)(\w+)/i);l=c+1,null!=i&&("/"==i[1]?n.length>0&&n[n.length-1]==i[2].toLowerCase()&&n.pop():"/"!=u.substring(c-1,c)&&n.push(i[2].toLowerCase()),r<l+1&&(r=l+1,a=u.substring(0,r)))}for(;;){var o=n.pop();if(null==o)break;a+="</"+o+">"}return $("#message").html(a),r<u.length||(r=e=0,s(),!1)},10,!0);break;case"dialog":!function t(e){var l=$("#dialog");a=!1;if(null!=e){var n=$("#dialogMessage"),c=$("#dialogButton"),i=null;if(null!=e.message?n.show().html(e.message):n.hide().empty(),null!=e.button){c.show().empty();for(var o=0;o<e.button.length;o++)if(null!=e.button[o]){var u=$("<button>");"string"==typeof e.button[o]?u.html(e.button[o]):u.html(e.button[o].text).attr(e.button[o].attr),u.click(function(t){return function(l){if(a){l.stopPropagation(),a=!1,clearTimeout(i);var s=$(this);s.parent().find("button").addClass("disable"),s.addClass("active");var n=this;Sound.play("button"),Tick.cycle("button",{scale:.1},function(l,c,i){if(!(i<2))return a=!0,s.css("transform","").parent().find("button").removeClass("disable").removeClass("active"),null!=e.callback&&e.callback.call(n,t),!1;s.css("transform","scale("+(1-l.scale)+", "+(1-l.scale)+")")},50)}}}(o+1)).appendTo(c)}}else c.hide().empty();e.closeable?$(document).on("click.dialog",function(){a&&(clearTimeout(i),t(null),null!=e.callback&&e.callback.call(this,0))}):$(document).off("click.dialog"),null!=e.autoCloseTime&&(i=setTimeout(function(){t(null),null!=e.callback&&e.callback.call(this,0)},e.autoCloseTime))}else $(document).off("click.dialog");var r=Tick.once("dialog",{scale:null==e?0:1},function(t,n){1==t.scale?l.show().css("transform","translate(-50%, -50%)"):t.scale>0?l.show().css("transform","translate(-50%, -50%) scale("+t.scale+", "+t.scale+")"):l.hide().css("transform",""),n>=1&&(null!=e&&(a=!0),s())},100);r||(null!=e&&(a=!0),s())}(t[0].option);break;case"interval":clearTimeout(l),l=setTimeout(function(){s()},t[0].duration);break;case"wait":(o=$("#messageWait")).show(),Tick.cycle("wait",{scale:1},function(t,e,a){o.css("transform","translate(0, "+3*t.scale+"px) scale(1, "+(1-.5*t.scale)+")")},400),$(document).off("click.wait").on("click.wait",function(){$(this).off("click.wait"),Tick.stop("wait"),o.hide().css("transform",""),s()});break;case"callback":c=t[0].func,"object"==typeof(i=c())?i.promise().then(function(){s()}):s();break;default:s()}}this.message=function(a){null!=$("#messageChara img").attr("src")&&(t.length>=1&&"message"==t[0].type&&e>1&&(Tick.stop("message"),s()),t.push({type:"message",msg:a}),1==t.length&&s(!0))},this.dialog=function(e){t.push({type:"dialog",option:e}),1==t.length&&s(!0)},this.interval=function(e){t.push({type:"interval",duration:e}),1==t.length&&s(!0)},this.wait=function(){t.push({type:"wait"}),1==t.length&&s(!0)},this.callback=function(e){t.push({type:"callback",func:e}),1==t.length&&s(!0)},this.clear=function(e){e||function(){if(0==t.length)return;switch(t[0].type){case"message":Tick.stop("message");break;case"dialog":break;case"interval":clearTimeout(l);break;case"wait":$(document).off("click.wait")}}(),t.splice(0,t.length)}};